<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Resultados anÃ¡lisis PDFs</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    table { border-collapse: collapse; width: 100%; margin-bottom: 20px; }
    th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
    th { background-color: #f0f0f0; }
    .nocturno { background-color: #ffe0e0; }
  </style>
</head>
<body>
  <h1>Resultados anÃ¡lisis PDFs</h1>
  {% set global_min = 0 %}
  {% set global_eur = 0 %}
  {% for filename, registros in resultados.items() %}
    {% set total_min = registros|map(attribute='nocturnidad_minutos')|sum %}
    {% set total_eur = registros|map(attribute='dinero')|sum %}
    {% set global_min = global_min + total_min %}
    {% set global_eur = global_eur + total_eur %}
    <h2>{{ filename }}</h2>
    <table>
      <tr>
        <th>Fecha</th><th>HI</th><th>HF</th>
        <th>Nocturnidad (min)</th><th>Dinero (â‚¬)</th><th>LÃ­nea completa</th>
      </tr>
      {% for r in registros %}
      <tr {% if r.nocturnidad_minutos > 0 %}class="nocturno"{% endif %}>
        <td>{{ r.fecha }}</td>
        <td>{{ r.hi }}</td>
        <td>{{ r.hf }}</td>
        <td>{{ r.nocturnidad_minutos }}</td>
        <td>{{ "%.2f"|format(r.dinero) }}</td>
        <td>{{ r.linea_completa }}</td>
      </tr>
      {% endfor %}
    </table>
    <p><b>Total minutos nocturnos en {{ filename }}: {{ total_min }}</b></p>
    <p><b>Total dinero en {{ filename }}: {{ "%.2f"|format(total_eur) }} â‚¬</b></p>
  {% endfor %}
  <hr>
  <h2>Resumen global</h2>
  <p><b>Total minutos nocturnos: {{ global_min }}</b></p>
  <p><b>Total dinero: {{ "%.2f"|format(global_eur) }} â‚¬</b></p>
  <p><a href="/download">ðŸ“¥ Descargar PDF</a></p>
</body>
</html>
